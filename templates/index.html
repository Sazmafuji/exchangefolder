<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Image Viewer</title>
  </head>
  <body>
    <div style="text-align:center">
      <h1>Image Viewer</h1>
    </div>
    <div style="display:flex; justify-content:center">
      <img id="currentImg" src="" style="max-width:500px; max-height:500px">
    </div>
    <div style="display:flex; justify-content:center">
      <button onclick="prevImg()">Prev</button>
      <button onclick="nextImg()">Next</button>
    </div>
    <div style="text-align:center">
      <h2>Select a folder</h2>
    </div>
    <div style="display:flex; justify-content:center">
      <form id="folderForm">
        <input type="file" id="fileInput" style="display:none" webkitdirectory directory multiple onchange="loadImages()">
        <button type="button" onclick="document.getElementById('fileInput').click()">Choose Folder</button>
      </form>
    </div>
    <script>
      var imgPaths = [];
      var currentImgIdx = 0;
      var numImages = 0;

      function loadImages() {
        var input = document.getElementById("fileInput");
        var folderPath = input.files[0].path;
        console.log("Folder selected: " + folderPath);
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
          if (this.readyState == 4 && this.status == 200) {
            imgPaths = JSON.parse(this.responseText);
            numImages = imgPaths.length;
            if (numImages > 0) {
              document.getElementById("currentImg").src = imgPaths[0];
              currentImgIdx = 0;
            }
          }
        };
        xhr.open("GET", "/load_images?folder=" + folderPath, true);
        xhr.send();
      }

      function prevImg() {
        if (currentImgIdx > 0) {
          currentImgIdx -= 1;
          document.getElementById("currentImg").src = imgPaths[currentImgIdx];
        }
      }

      function nextImg() {
        if (currentImgIdx < numImages - 1) {
          currentImgIdx += 1;
          document.getElementById("currentImg").src = imgPaths[currentImgIdx];
        }
      }
    </script>
  </body>
</html>
